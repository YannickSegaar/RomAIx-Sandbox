<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Email Router Animation V7 - RomAIx</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            /* --- PLACE YOUR BACKGROUND IMAGE URL HERE --- */
            background-image: url('YOUR_BACKGROUND_IMAGE.png'); /* <--- CHANGE THIS PATH */
            /* --- --- --- --- --- --- --- --- --- --- --- */
            background-color: #eef2f5; /* Fallback color */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            color: #333;
        }

        .animation-container {
            width: 95%;
            max-width: 1000px;
            height: 750px;
            background-color: rgba(255, 255, 255, 0.92);
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
            position: relative;
            padding: 40px;
            overflow: hidden;
        }

        /* Common styles for Router and Incoming Source Nodes */
        .node {
            position: absolute;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            z-index: 5;
            padding: 18px 25px;
        }
         .node .text { font-weight: 600; font-size: 15px; }
         .node .placeholder-img {
            width: 40px; height: 40px; border-radius: 8px; object-fit: cover;
         }

         .incoming-source {
             top: 50%; left: 5%; transform: translateY(-50%);
             background: linear-gradient(to right, #e8eaed, #f8f9fa);
             color: #3c4043; min-width: 180px;
         }
         .incoming-source .icon-img {
             width: 32px; height: 32px; object-fit: contain;
         }


        /* Router Styles */
        .router-agent {
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #2F3E46, #587C74);
            color: white; width: 240px; padding: 20px; z-index: 10;
            flex-direction: column; gap: 10px;
        }
        .router-agent .router-image-container {
            width: 55px; height: 55px; border-radius: 10px; overflow: hidden;
            background-color: rgba(255,255,255,0.1); flex-shrink: 0;
        }
         .router-agent .router-image-container img {
            width: 100%; height: 100%; object-fit: cover; display: block;
         }
         .router-agent .router-content {
             display: flex; align-items: center; justify-content: center; gap: 12px;
         }
         .router-agent .icon-img { /* Router Icon Image */
             width: 32px; height: 32px; border-radius: 50%;
             object-fit: cover; flex-shrink: 0;
         }
         .router-agent .text { font-size: 16px; }
         .router-agent.processing { animation: pulse 1s infinite; }

        /* Specialized Agent (Circular) */
        .specialized-agent {
            position: absolute; width: 160px; height: 160px; border-radius: 50%;
            background: linear-gradient(135deg, #dfe9f3, #ffffff); color: #333;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center; gap: 8px; padding: 15px; z-index: 5;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
         .specialized-agent .agent-avatar {
             width: 80px; height: 80px; border-radius: 50%; margin-bottom: 8px;
             display: flex; align-items: center; justify-content: center;
             overflow: hidden; background-color: rgba(0,0,0,0.05); flex-shrink: 0;
         }
         .specialized-agent .agent-avatar .icon-img { /* Agent Avatar Image */
             width: 32px; height: 32px; border-radius: 50%; object-fit: cover;
         }
         .specialized-agent .text {
             font-weight: 600; font-size: 14px; line-height: 1.3;
         }
         .specialized-agent.highlight {
             animation: highlight-pulse 0.8s ease;
             box-shadow: 0 0 30px rgba(88, 124, 116, 0.6);
         }

        /* Positioning the agents */
        .sales-agent { top: 10%; right: 8%; }
        .support-agent { top: 50%; right: 8%; transform: translateY(-50%); }
        .manager-agent { bottom: 10%; right: 8%; }

        /* --- NEW: Incoming Email Text Display --- */
        #incoming-email-text-display {
            position: absolute;
            background-color: #f0f4f8; /* Light blue-grey background */
            color: #333;
            padding: 12px 18px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-width: 220px; /* Limit width */
            font-size: 13px;
            line-height: 1.4;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            z-index: 15; /* Above nodes, below email icon potentially */
            /* Position will be set by JS */
        }

        /* Email Icon & Context (Label) */
        .email-icon-container {
            position: absolute;
            opacity: 0;
            /* Delay transition until after text fades */
            transition: top 1.5s ease-in-out 0.1s, left 1.5s ease-in-out 0.1s, opacity 0.3s ease-in-out;
            z-index: 20;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .email-icon { font-size: 30px; }
        .email-context-text { /* This now displays the LABEL */
            font-size: 11px; /* Smaller label text */
            font-weight: 700; /* Bold label */
            color: #fff;
            background-color: #e74c3c; /* Red background for label */
            padding: 3px 8px;
            border-radius: 4px;
            margin-top: 4px; /* Closer to icon */
            white-space: nowrap;
            opacity: 0;
            /* Fade in slightly after icon appears */
            transition: opacity 0.4s ease 0.2s;
        }
        .email-icon-container.visible .email-context-text { opacity: 1; }


        /* Arrow Styles */
        .arrow-container {
            position: absolute; height: 15px; opacity: 0;
            transition: opacity 0.5s ease; z-index: 1;
            pointer-events: none; transform-origin: left center;
        }
        .arrow-container.visible { opacity: 0.75; }
        .arrow-line {
            position: absolute; background-color: #555; height: 4px;
            left: 0; top: 50%; transform: translateY(-50%);
            width: 100%; border-radius: 2px;
        }
        .arrow-head {
            position: absolute; width: 0; height: 0; border-style: solid;
            border-width: 7px 0 7px 12px; border-color: transparent transparent transparent #555;
            right: -2px; top: 50%; transform: translateY(-50%);
        }
         #arrow-container-to-router .arrow-line,
         #arrow-container-to-router .arrow-head { background-color: #587C74; border-left-color: #587C74; }
         #arrow-container-to-sales .arrow-line, #arrow-container-to-sales .arrow-head,
         #arrow-container-to-support .arrow-line, #arrow-container-to-support .arrow-head,
         #arrow-container-to-manager .arrow-line, #arrow-container-to-manager .arrow-head { background-color: #8aa39e; border-left-color: #8aa39e; }


        /* Keyframes */
        @keyframes pulse { /* Unchanged */
            0% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1); }
            50% { transform: translate(-50%, -50%) scale(1.04); box-shadow: 0 8px 25px rgba(47, 62, 70, 0.3); }
            100% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1); }
        }
         @keyframes highlight-pulse { /* Unchanged */
             0% { transform: scale(1) translateY(0); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); }
             50% { transform: scale(1.06) translateY(0); box-shadow: 0 0 30px rgba(88, 124, 116, 0.6); }
             100% { transform: scale(1) translateY(0); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); }
         }
         .support-agent.highlight { animation-name: highlight-pulse-support; }
         @keyframes highlight-pulse-support { /* Unchanged */
             0% { transform: scale(1) translateY(-50%); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); }
             50% { transform: scale(1.06) translateY(-50%); box-shadow: 0 0 30px rgba(88, 124, 116, 0.6); }
             100% { transform: scale(1) translateY(-50%); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); }
         }

         /* Logo */
         .romix-logo { /* Unchanged */
             position: absolute; bottom: 20px; left: 25px; display: flex; align-items: center;
             gap: 10px; color: #2F3E46; font-weight: 700; font-size: 18px; opacity: 0.9; z-index: 1;
         }
         .romix-logo-icon { /* Unchanged */
             width: 35px; height: 35px; background-color: #2F3E46; border-radius: 8px;
             display: flex; align-items: center; justify-content: center; font-size: 16px; color: white;
         }

    </style>
</head>
<body>
    <div class="animation-container">

        <div class="node incoming-source" id="incoming-source">
            <span class="icon">ðŸ“¥</span> <span class="text">Incoming Email</span>
        </div>

        <div class="node router-agent" id="router">
             <div class="router-image-container">
                 </div>
             <div class="router-content">
                 <img src="CustomerSupportAgent.svg" alt="AI Router Icon" class="icon-img">
                 <span class="text">AI Router</span>
             </div>
        </div>

        <div class="specialized-agent sales-agent" id="sales-agent">
            <div class="agent-avatar">
                 <img src="CustomerSupportAgent.svg" alt="Sales Agent Avatar" class="icon-img">
            </div>
            <span class="text">Sales Agent</span>
        </div>
        <div class="specialized-agent support-agent" id="support-agent">
             <div class="agent-avatar">
                 <img src="CustomerSupportAgent.svg" alt="Support Agent Avatar" class="icon-img">
            </div>
            <span class="text">Support Agent</span>
        </div>
         <div class="specialized-agent manager-agent" id="manager-agent">
             <div class="agent-avatar">
                 <img src="CustomerSupportAgent.svg" alt="Manager Avatar" class="icon-img">
            </div>
            <span class="text">Manager</span>
        </div>

        <div id="incoming-email-text-display"></div>

        <div class="email-icon-container" id="email-container">
             <div class="email-icon">ðŸ“§</div>
             <div class="email-context-text" id="email-context">Routing...</div>
        </div>

        <div class="arrow-container" id="arrow-container-to-router">
            <div class="arrow-line"></div> <div class="arrow-head"></div>
        </div>
        <div class="arrow-container" id="arrow-container-to-sales">
             <div class="arrow-line"></div> <div class="arrow-head"></div>
        </div>
        <div class="arrow-container" id="arrow-container-to-support">
             <div class="arrow-line"></div> <div class="arrow-head"></div>
        </div>
        <div class="arrow-container" id="arrow-container-to-manager">
             <div class="arrow-line"></div> <div class="arrow-head"></div>
        </div>

        <div class="romix-logo">
             <div class="romix-logo-icon">R</div> RomAIx
         </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const animationContainer = document.querySelector('.animation-container');
            const emailContainer = document.getElementById('email-container');
            const emailContext = document.getElementById('email-context'); // Displays the LABEL
            const incomingEmailTextDisplay = document.getElementById('incoming-email-text-display'); // Displays the incoming EMAIL TEXT
            const router = document.getElementById('router');
            const incomingSource = document.getElementById('incoming-source');

            // --- Updated Data Structure with Email Text Examples ---
            const agents = [
                { element: document.getElementById('sales-agent'), arrowContainer: document.getElementById('arrow-container-to-sales'),
                  label: "Sales Inquiry", emailText: "Hi! Can I get a quote for a private tour for 10 people next Tuesday?" },
                { element: document.getElementById('support-agent'), arrowContainer: document.getElementById('arrow-container-to-support'),
                  label: "Support Request", emailText: "Hey, what time is my tour tomorrow?" },
                { element: document.getElementById('manager-agent'), arrowContainer: document.getElementById('arrow-container-to-manager'),
                  label: "Complaint", emailText: "Hi there! I have a special request..." }
            ];
            const arrowContainerToRouter = document.getElementById('arrow-container-to-router');

            let currentTargetAgentIndex = 0;

            // --- Updated Timings ---
            const timings = {
                initialDelay: 500,
                showEmailTextDelay: 200,       // Delay before showing incoming text
                displayEmailTextDuration: 3500, // How long incoming text stays visible
                textToIconDelay: 300,          // Pause between text fade out and icon fade in
                moveToRouterDuration: 1500,
                processingDelay: 1100,
                moveToAgentDuration: 1500,
                highlightDelay: 900,
                cycleDelay: 2500               // Slightly longer pause between full cycles
            };

            // --- Helper Functions (Unchanged) ---
            function getCenterPosition(element) {
                 const elemRect = element.getBoundingClientRect();
                 const containerRect = animationContainer.getBoundingClientRect();
                 const elemCenterX = elemRect.left + elemRect.width / 2;
                 const elemCenterY = elemRect.top + elemRect.height / 2;
                 const containerX = elemCenterX - containerRect.left;
                 const containerY = elemCenterY - containerRect.top;
                 return { left: containerX, top: containerY };
            }

            function updateArrow(arrowContainer, startPos, endPos) {
                const dx = endPos.left - startPos.left;
                const dy = endPos.top - startPos.top;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx);
                const angleDeg = angle * (180 / Math.PI);
                let startOffset = 0, endOffset = 0;

                if (arrowContainer === arrowContainerToRouter) {
                    startOffset = 90; endOffset = 120;
                } else {
                    startOffset = 120; endOffset = 80;
                }
                const adjustedStartLeft = startPos.left + startOffset * Math.cos(angle);
                const adjustedStartTop = startPos.top + startOffset * Math.sin(angle);
                const adjustedLength = Math.max(0, length - startOffset - endOffset);

                arrowContainer.style.width = `${adjustedLength}px`;
                arrowContainer.style.left = `${adjustedStartLeft}px`;
                arrowContainer.style.top = `${adjustedStartTop}px`;
                arrowContainer.style.transformOrigin = `0% 50%`;
                arrowContainer.style.transform = `rotate(${angleDeg}deg)`;
            }

            function hideAllArrows() {
                 arrowContainerToRouter.classList.remove('visible');
                 agents.forEach(agent => agent.arrowContainer.classList.remove('visible'));
            }

            // --- Updated Main Animation Loop ---
            function runAnimationCycle() {
                const targetAgentInfo = agents[currentTargetAgentIndex];
                const targetAgentElement = targetAgentInfo.element;
                const targetArrowContainer = targetAgentInfo.arrowContainer;
                const currentEmailLabel = targetAgentInfo.label; // Get the label
                const currentEmailText = targetAgentInfo.emailText; // Get the email text

                const sourcePos = getCenterPosition(incomingSource);
                const routerPos = getCenterPosition(router);
                const agentPos = getCenterPosition(targetAgentElement);

                const emailIconContRect = emailContainer.getBoundingClientRect();
                const emailContainerWidth = emailIconContRect.width || 80;
                const emailContainerHeight = emailIconContRect.height || 60;

                // Calculate position for incoming text display (e.g., above source)
                const textDisplayTop = sourcePos.top - 80; // Adjust vertical position as needed
                const textDisplayLeft = sourcePos.left - 30; // Adjust horizontal position

                // 1. Reset State
                emailContainer.style.opacity = '0';
                emailContainer.style.transition = 'none'; // Prevent transitions during reset
                incomingEmailTextDisplay.style.opacity = '0';
                hideAllArrows();
                emailContainer.classList.remove('visible'); // Hide label initially
                 // Ensure email icon is reset (position doesn't matter yet)
                 emailContainer.style.left = '0px';
                 emailContainer.style.top = '0px';


                // 2. Show Incoming Email Text Example
                setTimeout(() => {
                    incomingEmailTextDisplay.textContent = currentEmailText;
                    incomingEmailTextDisplay.style.left = `${textDisplayLeft}px`;
                    incomingEmailTextDisplay.style.top = `${textDisplayTop}px`;
                    incomingEmailTextDisplay.style.opacity = '1';
                }, timings.showEmailTextDelay);

                // 3. Fade Out Text, Prepare and Show Email Icon + Label
                const textFadeOutTime = timings.showEmailTextDelay + timings.displayEmailTextDuration;
                setTimeout(() => {
                    incomingEmailTextDisplay.style.opacity = '0'; // Start fading out text
                }, textFadeOutTime);

                // After text fades + short delay, show the email icon/label near source
                const showIconTime = textFadeOutTime + 500; // 500ms for fade out
                setTimeout(() => {
                    // Set the label text
                    emailContext.textContent = currentEmailLabel;

                    // Position email icon container near source
                    const startLeft = sourcePos.left + (incomingSource.offsetWidth / 2) - (emailContainerWidth / 4) + 10;
                    const startTop = sourcePos.top - (emailContainerHeight / 2);
                    emailContainer.style.left = `${startLeft}px`;
                    emailContainer.style.top = `${startTop}px`;

                    // Make icon container visible (label fades in via CSS)
                    emailContainer.style.transition = `top ${timings.moveToRouterDuration}ms ease-in-out, left ${timings.moveToRouterDuration}ms ease-in-out, opacity 0.3s ease-in-out`; // Reset transition
                    emailContainer.style.opacity = '1';
                    emailContainer.classList.add('visible');

                    // Update and show arrow to router
                    updateArrow(arrowContainerToRouter, sourcePos, routerPos);
                    arrowContainerToRouter.classList.add('visible');

                    // 4. Move Email Icon (with label) to Router
                    // Use a nested timeout to ensure positioning happens after opacity transition starts
                    setTimeout(() => {
                        const targetRouterLeft = routerPos.left - (emailContainerWidth / 2);
                        const targetRouterTop = routerPos.top - (emailContainerHeight / 2);
                        emailContainer.style.left = `${targetRouterLeft}px`;
                        emailContainer.style.top = `${targetRouterTop}px`;
                    }, 50); // Small delay

                }, showIconTime + timings.textToIconDelay);


                // 5. Router Processing
                const processingStartTime = showIconTime + timings.textToIconDelay + timings.moveToRouterDuration;
                setTimeout(() => {
                    router.classList.add('processing');
                    arrowContainerToRouter.classList.remove('visible');
                }, processingStartTime);


                // 6. Prepare and Move Email to Agent
                const moveToAgentStartTime = processingStartTime + timings.processingDelay;
                setTimeout(() => {
                    router.classList.remove('processing');
                    updateArrow(targetArrowContainer, routerPos, agentPos);
                    targetArrowContainer.classList.add('visible');

                    emailContainer.style.transition = `top ${timings.moveToAgentDuration}ms ease-in-out, left ${timings.moveToAgentDuration}ms ease-in-out, opacity 0.5s ease`;

                    const targetAgentLeft = agentPos.left - (emailContainerWidth / 2);
                    const targetAgentTop = agentPos.top - (emailContainerHeight / 2);
                    emailContainer.style.left = `${targetAgentLeft}px`;
                    emailContainer.style.top = `${targetAgentTop}px`;

                }, moveToAgentStartTime);


                // 7. Highlight Agent & Hide Email/Arrow
                const highlightStartTime = moveToAgentStartTime + timings.moveToAgentDuration;
                setTimeout(() => {
                    emailContainer.style.opacity = '0';
                    emailContainer.classList.remove('visible'); // Hide label too
                    targetArrowContainer.classList.remove('visible');
                    targetAgentElement.classList.add('highlight');
                }, highlightStartTime);


                // 8. Remove Highlight
                const removeHighlightTime = highlightStartTime + timings.highlightDelay;
                setTimeout(() => {
                    targetAgentElement.classList.remove('highlight');
                }, removeHighlightTime);


                // 9. Prepare for Next Cycle
                const nextCycleTime = removeHighlightTime + timings.cycleDelay;
                setTimeout(() => {
                    currentTargetAgentIndex = (currentTargetAgentIndex + 1) % agents.length;
                    runAnimationCycle(); // Loop
                }, nextCycleTime);
            }

            // Start the first cycle
            setTimeout(runAnimationCycle, timings.initialDelay);
        });
    </script>
</body>
</html>
